# Workflow to retrieve metadata from CoinGecko, parse and upload the metadata, 
# and rebuild the core.coin_metdata_coingecko table.Â 
main:
    steps:
    - init:
        assign:
        - project: ${sys.get_env("GOOGLE_CLOUD_PROJECT_ID")}
        - service_account: western-verve-411004@appspot.gserviceaccount.com
    - retrieveCoinMetadata:
        call: http.get
        args:
            url: https://coingecko-coin-metadata-fatui3rd2a-uw.a.run.app
            auth:
                type: OIDC
            timeout: 1800
    - parseMetadataJson:
        call: http.get
        args:
            url: https://coingecko-parse-json-fatui3rd2a-uw.a.run.app
            auth:
                type: OIDC
    - rebuildCoreTable:
        call: http.get
        args:
            url: https://core-coin-facts-coingecko-fatui3rd2a-uw.a.run.app
            auth:
                type: OIDC
        result: resp
    - returnOutput:
            return: '${resp}'
